<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lavander칤a Rivera - Pedidos</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body { background-color: #F3F4F6; }
        .gps-btn { animation: pulse-blue 2s infinite; }
        @keyframes pulse-blue {
            0% { box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(59, 130, 246, 0); }
            100% { box-shadow: 0 0 0 0 rgba(59, 130, 246, 0); }
        }
        input::-webkit-outer-spin-button, input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
        .btn-disabled { opacity: 0.3; cursor: not-allowed; pointer-events: none; }
        .tarifa-box { border: 2px dashed #1e3a8a; background-color: #eff6ff; }
    </style>
</head>
<body class="flex justify-center items-center min-h-screen p-4 font-sans text-gray-700">

    <div class="bg-white w-full max-w-md rounded-xl shadow-2xl p-6 border-t-8 border-blue-900">
        
        <h1 class="text-2xl font-extrabold text-center text-blue-900 mb-2">LAVANDER칈A RIVERA</h1>
        <p class="text-center text-gray-500 mb-4 text-sm">Haz tu cotizacion de manera inteligente.</p>

        <div class="tarifa-box p-3 rounded-lg mb-6 text-center shadow-inner">
            <h4 class="text-blue-900 font-bold text-xs uppercase mb-2 tracking-widest italic">游늶 Lista de Precios</h4>
            <div class="grid grid-cols-3 gap-1">
                <div class="bg-white p-2 rounded border border-blue-100">
                    <p class="text-[9px] font-bold text-gray-500 uppercase">8-20 lbs</p>
                    <p class="text-sm font-black text-blue-900">C$ 20</p>
                </div>
                <div class="bg-white p-2 rounded border border-blue-100">
                    <p class="text-[9px] font-bold text-gray-500 uppercase">21-25 lbs</p>
                    <p class="text-sm font-black text-green-600">C$ 19</p>
                </div>
                <div class="bg-white p-2 rounded border border-blue-100">
                    <p class="text-[9px] font-bold text-gray-500 uppercase">26+ lbs</p>
                    <p class="text-sm font-black text-orange-600">C$ 18</p>
                </div>
            </div>
        </div>

        <div class="bg-gray-50 p-4 rounded-xl border border-gray-200 mb-6 text-center">
            <label class="block font-bold text-gray-800 text-lg mb-2">丘뒲잺 쮺u치nto pesa tu ropa?</label>
            <div class="flex items-center justify-center gap-4 max-w-[250px] mx-auto">
                <button id="btnMenos" onclick="cambiarPeso(-1)" class="w-12 h-12 rounded-full bg-white border-2 border-blue-200 text-blue-900 text-2xl font-bold flex items-center justify-center hover:bg-blue-50 active:scale-90 transition shadow-sm">-</button>
                <div class="relative">
                    <input type="number" id="libras" value="8" min="8" class="w-20 text-center text-3xl font-extrabold py-1 bg-transparent text-blue-900 focus:outline-none" oninput="validarInput()" onblur="asegurarMinimo()">
                    <span class="block text-[10px] text-gray-400 font-bold uppercase tracking-tighter">Libras (Lbs)</span>
                </div>
                <button onclick="cambiarPeso(1)" class="w-12 h-12 rounded-full bg-white border-2 border-blue-200 text-blue-900 text-2xl font-bold flex items-center justify-center hover:bg-blue-50 active:scale-90 transition shadow-sm">+</button>
            </div>
        </div>

        <div class="bg-blue-50 border border-blue-200 rounded-xl p-3 mb-6">
            <div class="grid grid-cols-3 gap-2 mb-4">
                <button onclick="setMode('local')" id="btnLocal" class="py-2 px-1 rounded-lg text-[11px] font-bold bg-blue-900 text-white shadow-md flex flex-col items-center">
                    <i class="fas fa-store mb-1 text-base"></i> Local
                </button>
                <button onclick="setMode('delivery')" id="btnDelivery" class="py-2 px-1 rounded-lg text-[11px] font-bold bg-white text-gray-600 border border-gray-300 flex flex-col items-center">
                    <i class="fas fa-arrow-right mb-1 text-base"></i> 1 V칤a
                </button>
                <button onclick="setMode('roundtrip')" id="btnRoundtrip" class="py-2 px-1 rounded-lg text-[11px] font-bold bg-white text-gray-600 border border-gray-300 flex flex-col items-center">
                    <i class="fas fa-sync-alt mb-1 text-base"></i> Ida/Vuelta
                </button>
            </div>

            <div id="gpsPanel" class="hidden">
                <button onclick="obtenerUbicacion()" class="gps-btn w-full bg-orange-500 hover:bg-orange-600 text-white font-bold py-3 rounded-lg flex justify-center items-center gap-2 mb-3 shadow-md">
                    <i class="fas fa-location-arrow"></i> DETECTAR UBICACI칍N
                </button>
                <div id="resultGPS" class="hidden bg-white p-3 rounded-lg border border-gray-200 text-center animate-pulse-slow">
                    <p class="text-xs text-gray-600">Distancia: <span id="distanciaKm">0</span> km</p>
                    <p class="text-sm font-bold text-green-600">Costo Env칤o: NIO <span id="costoEnvioDisplay">0</span></p>
                </div>
            </div>
        </div>

        <div class="space-y-3 mb-6">
            <input type="text" id="nombre" placeholder="Tu Nombre Completo" class="w-full p-3 border border-gray-300 rounded-lg text-sm bg-gray-50 focus:ring-2 focus:ring-blue-900 outline-none">
            <input type="text" id="direccion" placeholder="Referencia de tu casa" class="w-full p-3 border border-gray-300 rounded-lg text-sm bg-gray-50 focus:ring-2 focus:ring-blue-900 outline-none">
        </div>

        <div class="bg-blue-900 text-white p-5 rounded-xl flex justify-between items-center mb-4 shadow-xl">
            <div>
                <p class="text-[10px] text-blue-300 uppercase font-black tracking-widest">Total Estimado</p>
                <p class="text-3xl font-extrabold">NIO <span id="totalDisplay">160.00</span></p>
            </div>
            <div class="text-right text-[10px] text-blue-200">
                <p id="labelEnvioFinal" class="font-bold">Entrega Local</p>
                <p id="labelDeliveryFinal" class="text-white text-sm">+ NIO 0</p>
            </div>
        </div>

        <button onclick="enviarPedido()" class="w-full bg-green-500 hover:bg-green-600 text-white font-bold py-4 rounded-xl shadow-lg flex justify-center items-center gap-2 text-lg active:scale-95 transition">
            <i class="fab fa-whatsapp text-2xl"></i> CONFIRMAR PEDIDO
        </button>
    </div>

    <script>
        const MI_WHATSAPP = "+50589612689"; //Numero de whatsapp para recibir pedidos. Cambia el n칰mero a tu n칰mero real, incluyendo el c칩digo de pa칤s (ejemplo: +50589612689 para Nicaragua).
        const TIENDA_LAT = 12.1550; 
        const TIENDA_LON = -86.3500; 

        let distanciaActual = 0; 
        let costoUnViaje = 0;
        let modoEntrega = 'local';

        function cambiarPeso(v) {
            let input = document.getElementById('libras');
            let n = (parseInt(input.value) || 8) + v;
            if (n >= 8) { input.value = n; calcularTotal(); }
        }

        function asegurarMinimo() { 
            if (parseInt(document.getElementById('libras').value) < 8) document.getElementById('libras').value = 8; 
            calcularTotal(); 
        }

        function validarInput() { calcularTotal(); }

        function setMode(mode) {
            modoEntrega = mode;
            document.getElementById('btnLocal').className = (mode === 'local' ? "py-2 px-1 rounded-lg text-[11px] font-bold bg-blue-900 text-white shadow-md flex flex-col items-center" : "py-2 px-1 rounded-lg text-[11px] font-bold bg-white text-gray-600 border border-gray-300 flex flex-col items-center");
            document.getElementById('btnDelivery').className = (mode === 'delivery' ? "py-2 px-1 rounded-lg text-[11px] font-bold bg-blue-900 text-white shadow-md flex flex-col items-center" : "py-2 px-1 rounded-lg text-[11px] font-bold bg-white text-gray-600 border border-gray-300 flex flex-col items-center");
            document.getElementById('btnRoundtrip').className = (mode === 'roundtrip' ? "py-2 px-1 rounded-lg text-[11px] font-bold bg-blue-900 text-white shadow-md flex flex-col items-center" : "py-2 px-1 rounded-lg text-[11px] font-bold bg-white text-gray-600 border border-gray-300 flex flex-col items-center");
            
            document.getElementById('gpsPanel').classList.toggle('hidden', mode === 'local');
            calcularTotal();
        }

        function obtenerUbicacion() {
            if (!navigator.geolocation) return alert("Tu navegador no soporta GPS");
            
            navigator.geolocation.getCurrentPosition((pos) => {
                const dist = calcularDistanciaHaversine(TIENDA_LAT, TIENDA_LON, pos.coords.latitude, pos.coords.longitude);
                distanciaActual = (dist * 1.3).toFixed(2);
                
                // L칩gica de env칤o: Menos de 2km = 20. M치s de 2km = 10 por km.
                costoUnViaje = (distanciaActual <= 2) ? 20 : Math.ceil(distanciaActual * 10);

                document.getElementById('resultGPS').classList.remove('hidden');
                document.getElementById('distanciaKm').innerText = distanciaActual;
                calcularTotal();
            }, () => alert("Por favor, activa el GPS para calcular el env칤o."));
        }

        function calcularDistanciaHaversine(lat1, lon1, lat2, lon2) {
            const R = 6371;
            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLon = (lon2 - lon1) * Math.PI / 180;
            const a = Math.sin(dLat/2)**2 + Math.cos(lat1*Math.PI/180)*Math.cos(lat2*Math.PI/180)*Math.sin(dLon/2)**2;
            return R * 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
        }

        function calcularTotal() {
            let lbs = parseFloat(document.getElementById('libras').value) || 8;
            if (lbs < 8) lbs = 8;

            // --- L칩gica de precios  ---
            let precioLbs = 20; 
            if (lbs >= 21 && lbs <= 25) precioLbs = 19;
            else if (lbs >= 26) precioLbs = 18;

            let totalRopa = lbs * precioLbs;

            // Bloquear bot칩n menos
            document.getElementById('btnMenos').classList.toggle('btn-disabled', lbs <= 8);

            let envioFinal = 0;
            if (modoEntrega === 'delivery') {
                envioFinal = costoUnViaje;
                document.getElementById('labelEnvioFinal').innerText = "Env칤o 1 V칤a";
            } else if (modoEntrega === 'roundtrip') {
                envioFinal = costoUnViaje * 2;
                document.getElementById('labelEnvioFinal').innerText = "Ida y Vuelta";
            } else {
                envioFinal = 0;
                document.getElementById('labelEnvioFinal').innerText = "Local";
            }

            document.getElementById('costoEnvioDisplay').innerText = envioFinal;
            document.getElementById('labelDeliveryFinal').innerText = "+ NIO " + envioFinal;
            document.getElementById('totalDisplay').innerText = (totalRopa + envioFinal).toFixed(2);
        }

        function enviarPedido() {
            const n = document.getElementById('nombre').value;
            const d = document.getElementById('direccion').value;
            const l = document.getElementById('libras').value;
            const t = document.getElementById('totalDisplay').innerText;

            if (!n || !d) return alert("Por favor, ingresa tu nombre y direcci칩n.");
            if (modoEntrega !== 'local' && costoUnViaje === 0) return alert("Presiona 'DETECTAR UBICACI칍N' para calcular el costo del env칤o.");

            let msg = `游빜 *ORDEN LAVANDER칈A RIVERA*%0A游녻 *Cliente:* ${n}%0A丘뒲잺 *Peso:* ${l} lbs%0A游띳 *Modo:* ${document.getElementById('labelEnvioFinal').innerText}%0A游늸 *Distancia:* ${distanciaActual} km%0A游 *Ref:* ${d}%0A游눯 *TOTAL: NIO ${t}*`;
            window.open(`https://wa.me/${MI_WHATSAPP}?text=${msg}`, '_blank');
        }
        
        calcularTotal();
    </script>
</body>
</html>